#!/bin/sh
#
# Pre-commit hook to remind developers to update MASTER_DOCUMENTATION.md
# when making code changes
#

# Colors for output
RED='\033[0;31m'
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

# Get list of staged files
STAGED_FILES=$(git diff --cached --name-only)

# Check if any code files are being committed
CODE_CHANGED=false
for file in $STAGED_FILES; do
    case "$file" in
        *.py|*.js|*.html|*.css|config.py|requirements.txt|.env*)
            CODE_CHANGED=true
            break
            ;;
    esac
done

# Check if MASTER_DOCUMENTATION.md is being updated
DOC_UPDATED=false
for file in $STAGED_FILES; do
    if [ "$file" = "MASTER_DOCUMENTATION.md" ]; then
        DOC_UPDATED=true
        break
    fi
done

# If code changed but docs not updated, show reminder
if [ "$CODE_CHANGED" = true ] && [ "$DOC_UPDATED" = false ]; then
    echo "${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo "${YELLOW}âš ï¸  DOCUMENTATION REMINDER${NC}"
    echo "${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo ""
    echo "You are committing code changes, but ${RED}MASTER_DOCUMENTATION.md${NC} is not included."
    echo ""
    echo "ğŸ“‹ Does your change require documentation updates?"
    echo ""
    echo "   ${GREEN}âœ“${NC} New features or functionality"
    echo "   ${GREEN}âœ“${NC} Configuration changes"
    echo "   ${GREEN}âœ“${NC} Data flow modifications"
    echo "   ${GREEN}âœ“${NC} Bug fixes (add to troubleshooting)"
    echo "   ${GREEN}âœ“${NC} New files or restructuring"
    echo ""
    echo "If YES, please:"
    echo "  1. ${YELLOW}Ctrl+C${NC} to cancel this commit"
    echo "  2. Update ${YELLOW}MASTER_DOCUMENTATION.md${NC}"
    echo "  3. Run: ${YELLOW}git add MASTER_DOCUMENTATION.md${NC}"
    echo "  4. Commit again"
    echo ""
    echo "If NO (refactoring/formatting only):"
    echo "  - Press ${GREEN}Enter${NC} to continue"
    echo ""
    echo "See ${YELLOW}CONTRIBUTING.md${NC} for documentation guidelines"
    echo "${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo ""
    
    # Prompt user to continue or cancel
    printf "Continue with commit? [y/N] "
    read -r response
    case "$response" in
        [yY][eE][sS]|[yY]) 
            echo "${GREEN}âœ“ Proceeding with commit${NC}"
            exit 0
            ;;
        *)
            echo "${RED}âœ— Commit cancelled. Please update documentation.${NC}"
            exit 1
            ;;
    esac
else
    # Either no code changed, or docs were updated
    if [ "$DOC_UPDATED" = true ]; then
        echo "${GREEN}âœ“ Documentation updated - good job!${NC}"
    fi
    exit 0
fi
