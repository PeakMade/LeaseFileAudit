# Azure App Service Easy Auth Configuration
# ==========================================
# These environment variables should be configured in Azure App Service Configuration
# or your local .env file for development

# Flask Configuration
SECRET_KEY=your-secret-key-here-change-in-production

# Azure AD Authentication (required for Easy Auth)
# -------------------------------------------------
# Get these from your Azure App Registration:
SHAREPOINT_CLIENT_ID=your-azure-app-registration-client-id
SHAREPOINT_TENANT_ID=your-azure-tenant-id
MICROSOFT_PROVIDER_AUTHENTICATION_SECRET=your-client-secret

# Authentication Settings
# -----------------------
# Set to 'false' to disable authentication requirement (for local dev without Easy Auth)
REQUIRE_AUTH=true

# SharePoint Logging Configuration (optional)
# -------------------------------------------
# Enable logging user activity to SharePoint
ENABLE_SHAREPOINT_LOGGING=false

# SharePoint site URL (e.g., https://contoso.sharepoint.com/sites/audit)
SHAREPOINT_SITE_URL=https://your-tenant.sharepoint.com/sites/your-site

# Name of the SharePoint list to log to (default: AuditLog)
SHAREPOINT_LIST_NAME=AuditLog

# Azure App Service Easy Auth Configuration Notes
# ================================================
# 
# When deployed to Azure App Service with Easy Auth enabled:
# 
# 1. Configure Authentication in Azure Portal:
#    - Go to your App Service -> Authentication
#    - Click "Add identity provider"
#    - Select "Microsoft" as the identity provider
#    - Choose "Workforce" for organizational accounts
#    - Set "Client ID" to your SHAREPOINT_CLIENT_ID
#    - Set "Client Secret" to your MICROSOFT_PROVIDER_AUTHENTICATION_SECRET
#    - Set "Issuer URL" to: https://login.microsoftonline.com/{TENANT_ID}/v2.0
#    - Set "Restrict access" to "Require authentication"
#    - Set "Unauthenticated requests" to "HTTP 302 Found redirect: recommended for websites"
# 
# 2. API Permissions for your App Registration:
#    - Microsoft Graph API:
#      * User.Read (Delegated) - Required for reading user profile
#      * email (Delegated) - Required for getting user email
#      * openid (Delegated) - Required for OpenID Connect
#      * profile (Delegated) - Required for user profile information
#    
#    - If using SharePoint logging:
#      * SharePoint -> AllSites.Write (Delegated) - Required for writing to SharePoint lists
#      * OR specific site permissions
# 
# 3. Token Configuration:
#    - In Azure Portal -> App Registration -> Token configuration
#    - Add optional claims for ID tokens:
#      * email
#      * family_name
#      * given_name
#      * upn
# 
# 4. App Service Configuration:
#    - In Azure Portal -> App Service -> Configuration -> Application settings
#    - Add all the environment variables above
#    - Ensure the following Easy Auth headers are enabled (automatic with Easy Auth):
#      * X-MS-CLIENT-PRINCIPAL (contains user claims)
#      * X-MS-TOKEN-AAD-ACCESS-TOKEN (contains access token)
# 
# 5. SharePoint List Schema (if using SharePoint logging):
#    Create a list named "AuditLog" with the following columns:
#    - Title (Single line of text) - Auto-created
#    - UserName (Single line of text)
#    - UserEmail (Single line of text)
#    - ActivityType (Single line of text)
#    - AppName (Single line of text)
#    - Timestamp (Date and Time)
#    - IPAddress (Single line of text)
#    - UserAgent (Multiple lines of text)
#    - Details (Multiple lines of text)
# 
# Local Development (without Easy Auth)
# ======================================
# For local development, you can set REQUIRE_AUTH=false to bypass authentication.
# Alternatively, you can test with mock headers:
# 
# X-MS-CLIENT-PRINCIPAL: base64-encoded JSON with user claims
# X-MS-TOKEN-AAD-ACCESS-TOKEN: valid Azure AD access token
# 
# To generate a mock header for testing:
# ```python
# import base64
# import json
# 
# mock_principal = {
#     "user_id": "test-user-id",
#     "identity_provider": "aad",
#     "claims": [
#         {"typ": "name", "val": "Test User"},
#         {"typ": "emailaddress", "val": "test@example.com"}
#     ]
# }
# 
# encoded = base64.b64encode(json.dumps(mock_principal).encode()).decode()
# print(f"X-MS-CLIENT-PRINCIPAL: {encoded}")
# ```
